{"componentChunkName":"component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-post-tsx","path":"/2023-01-05-chat-infra","result":{"data":{"post":{"id":"8d38cb50-9f68-561d-adef-a4abcb7236dc","headings":[{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":2},{"depth":2},{"depth":3},{"depth":2},{"depth":3},{"depth":3}],"frontmatter":{"title":"채팅 서비스를 위한 인프라","path":"/2023-01-05-chat-infra","tags":["project","websocket","nginx","kafka"],"excerpt":"Nginx, Kafka를 이용해 채팅서버를 다중화 해보자","created":"2023-01-05T00:00:00.000Z","createdPretty":"05 January, 2023","updated":"2023-01-05T00:00:00.000Z","updatedPretty":"05 January, 2023","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAdiBC4F//8QAGBAAAgMAAAAAAAAAAAAAAAAAAREAEyL/2gAIAQEAAQUCDr0w5//EABcRAAMBAAAAAAAAAAAAAAAAAAECEDH/2gAIAQMBAT8BTBP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAACAQUAAAAAAAAAAAAAAAAAEQISISIxQv/aAAgBAQAGPwLFEqXvouj/xAAaEAABBQEAAAAAAAAAAAAAAAAAESExUWGB/9oACAEBAAE/IWknTQIxwlsZKP/aAAwDAQACAAMAAAAQ9A//xAAYEQACAwAAAAAAAAAAAAAAAAAAARExYf/aAAgBAwEBPxCxiG5P/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAh/9oACAECAQE/EHFn/8QAGxAAAQUBAQAAAAAAAAAAAAAAEQABITFhcfD/2gAIAQEAAT8QbQigsFzqFM3hEx8U1mxZwdX/2Q==","aspectRatio":2.4691358024691357,"src":"/static/a2cf1bf133faff4a348c8c7c82544f36/f2cbb/6_container-network.jpg","srcSet":"/static/a2cf1bf133faff4a348c8c7c82544f36/8850c/6_container-network.jpg 200w,\n/static/a2cf1bf133faff4a348c8c7c82544f36/da113/6_container-network.jpg 400w,\n/static/a2cf1bf133faff4a348c8c7c82544f36/f2cbb/6_container-network.jpg 800w,\n/static/a2cf1bf133faff4a348c8c7c82544f36/c26c2/6_container-network.jpg 1200w,\n/static/a2cf1bf133faff4a348c8c7c82544f36/9352a/6_container-network.jpg 1600w,\n/static/a2cf1bf133faff4a348c8c7c82544f36/e2404/6_container-network.jpg 1967w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<h2 id=\"목차\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%EC%B0%A8\" aria-label=\"목차 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목차</h2>\n<ul>\n<li>요구사항</li>\n<li>웹 채팅 서비스</li>\n<li>Web Socket</li>\n<li>Message Queue</li>\n<li>구성도</li>\n</ul>\n<h2 id=\"요구사항\" style=\"position:relative;\"><a href=\"#%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD\" aria-label=\"요구사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>요구사항</h2>\n<p><a href=\"https://github.com/goo-gy/letters-react\">https://github.com/goo-gy/letters-react</a></p>\n<p><a href=\"https://github.com/goo-gy/letter-chat-server\">https://github.com/goo-gy/letter-chat-server</a></p>\n<ul>\n<li>Letters라는 웹 어플리케이션에서 채팅 기능을 제공하려고 한다.</li>\n<li>서버의 수를 늘려서 Scale-out 하고 싶다.</li>\n</ul>\n<h2 id=\"웹-채팅-서비스\" style=\"position:relative;\"><a href=\"#%EC%9B%B9-%EC%B1%84%ED%8C%85-%EC%84%9C%EB%B9%84%EC%8A%A4\" aria-label=\"웹 채팅 서비스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>웹 채팅 서비스</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0c61ea0093e48c0329bd1812621556f9/2ed8b/1_chat.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAUA/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwEC/9oADAMBAAIQAxAAAAGqgy6UvVNpP//EABsQAQABBQEAAAAAAAAAAAAAAAEDAAIEEBEi/9oACAEBAAEFAogLl4GTJUR61//EABYRAAMAAAAAAAAAAAAAAAAAAAMQMv/aAAgBAwEBPwEUr//EABkRAAEFAAAAAAAAAAAAAAAAAAABAhIxUf/aAAgBAgEBPwF1kkw//8QAGRAAAgMBAAAAAAAAAAAAAAAAARAAESIz/9oACAEBAAY/Ajq1zhf/xAAaEAEAAgMBAAAAAAAAAAAAAAABABEQQXGB/9oACAEBAAE/IaQPEZULoiDbxhZf/9oADAMBAAIAAwAAABB83//EABkRAAEFAAAAAAAAAAAAAAAAAAABESExUf/aAAgBAwEBPxCmBl0//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxAF/8QAHRAAAgIBBQAAAAAAAAAAAAAAAREAIUEQMVFxwf/aAAgBAQABPxAwm1YwuMHSEDmo2J0D5AFDYIMvOv8A/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1_chat.jpg\"\n        title=\"1_chat.jpg\"\n        src=\"/static/0c61ea0093e48c0329bd1812621556f9/e5166/1_chat.jpg\"\n        srcset=\"/static/0c61ea0093e48c0329bd1812621556f9/f93b5/1_chat.jpg 300w,\n/static/0c61ea0093e48c0329bd1812621556f9/b4294/1_chat.jpg 600w,\n/static/0c61ea0093e48c0329bd1812621556f9/e5166/1_chat.jpg 1200w,\n/static/0c61ea0093e48c0329bd1812621556f9/2ed8b/1_chat.jpg 1648w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 631px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/27281cfcc719fc308fd8ad60f6aa0805/4597d/2_http-protocol.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTElEQVQY02MoWnFIYsIJjemnlWae1+venlLSsnrbwf///7989erixYsXLlw4e+bsgwcP/v/79/jJs9C4JH1nYyVdUxkNg8ikdIbSjeeklj5WW/FIec1L49lnMsvbt+w/AdT8+/dvIPnv378/f/78+vULyH7x8mVybqltaLKVi6+upVN2SRVD2fxtSlXLHHs36restahbOHnuil2HTgOVvn379tatW/fA4MWLF0CRx0+ehiakqTn5qOiZSasbRiVnMNx79GTNxq21eSlzZs9avHb7jMUbTpy/CrTyzZs3r169evny5bNnz16/fv33798PHz9On7egZeLUps7u+vbueYuXMQCNBDrs2vUbQDkg+8fPX3///vsPBkDxHz9+AN0M8wJI8Pu3ry9fvgBKAdkMf/+BAEQOwoAAIBto7ZMnT4Bufv78OVwQov4vGAAACPYUhy1orIMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2_http-protocol.png\"\n        title=\"2_http-protocol.png\"\n        src=\"/static/27281cfcc719fc308fd8ad60f6aa0805/4597d/2_http-protocol.png\"\n        srcset=\"/static/27281cfcc719fc308fd8ad60f6aa0805/5a46d/2_http-protocol.png 300w,\n/static/27281cfcc719fc308fd8ad60f6aa0805/0a47e/2_http-protocol.png 600w,\n/static/27281cfcc719fc308fd8ad60f6aa0805/4597d/2_http-protocol.png 631w\"\n        sizes=\"(max-width: 631px) 100vw, 631px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a href=\"https://www.w3schools.in/http/intro\">https://www.w3schools.in/http/intro</a></p>\n<p>HTTP 통신은 클라이언트가 보낸 요청(Request)에 대해서만 응답(Response)을 보내줄 수 있고, 채팅 서비스에 필요한 서버 → Client로 먼저 데이터를 보내는 기능이 없습니다. 이를 해결하기 위해 우리는 WebSocket이라는 것을 사용할 수 있습니다.</p>\n<h2 id=\"web-socket\" style=\"position:relative;\"><a href=\"#web-socket\" aria-label=\"web socket permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web Socket</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 589px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3465192eb5e36afbd0da910f3cb16138/b1665/3_http-websocket.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAACd0lEQVQ4y5VUyW7bMBDV//9E+wHNoYcWbW4FUjRNl0PaArZTxDKkaKEkbuImcVGGWpyktw5owpbmvXnzOHQyTZOz3g5OcMWpHI2F78GH6VmEMBllOZOMStiVGLyLCQl8xsHBnmXl4S41ZgyAdf+ClTT7u/vD4Xi4O2LMpvl9AkWcDaMBBGRNAAMuO9OtSB9gQUL84eM2KKf7ERgTyQfWKC3GENki0eFb/fPylO9JTPZBsgGXEtLCTA9Pdtfll7f3pz9d0hXi6mLfY7MIhQo374+Xr37trqsIdoG1+ubdPankIgTYv39IL1//3n2tEt6aHx9zyJglxi3bkc8XKUVqeQKVbz+VXSGX5iGqI796cyS1SkIITS5Bth38yu0CqZ+4ILoC+rLnBKDAlV7dbmty2qO24s47772zzkh7zoNgrEclrU60Lfom77UYjBqBOoLBujnPS6k7TBDCuOnPyJggLJjlnBNCUsJxx0jbr5U5UcMwQiilEOpQ3ZGOz+CwKO+plkKVFWpa3GFKWU+6DZyf0N/bsnlgIHs5HiPsdsozmOg4PFDdw3KTtZqZFaz6wTkYhSCVKkuUP1QtYlvliDaIBkImKeISYqJUd2IFQx1gtd4ppUFY22KKt55nsC47j+lkNEzppDV0v9i0yk53iCCxyIZhNNI9l62J8lJFwT76NkVjxZNhnEjRa60N+AkHw7DYKs9gOoONWpVzZs6GxVOdk4wZsqxI07xF5EXPFcgmTokgBByX4b2gcgWTpgeroKwZhsVtxccXQ9IKVKKHokqz8pQVdd2iimyyOx3C0wWGywDz/LxnTvRo4xVXCv4roh0LezL9f4St1CNU4UmR5KBBWAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3_http-websocket.png\"\n        title=\"3_http-websocket.png\"\n        src=\"/static/3465192eb5e36afbd0da910f3cb16138/b1665/3_http-websocket.png\"\n        srcset=\"/static/3465192eb5e36afbd0da910f3cb16138/5a46d/3_http-websocket.png 300w,\n/static/3465192eb5e36afbd0da910f3cb16138/b1665/3_http-websocket.png 589w\"\n        sizes=\"(max-width: 589px) 100vw, 589px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a href=\"https://blog.scaleway.com/iot-hub-what-use-case-for-websockets/\">https://blog.scaleway.com/iot-hub-what-use-case-for-websockets/</a></p>\n<p>WebSocket을 이용하면 한번 Socket 연결을 맺고 나면, 양 측에서 언제든지 메세지를 보낼 수 있습니다.</p>\n<hr>\n<h3 id=\"web-socket-in-java-spring\" style=\"position:relative;\"><a href=\"#web-socket-in-java-spring\" aria-label=\"web socket in java spring permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web Socket in Java Spring</h3>\n<ul>\n<li>Web Socket</li>\n<li>SockJS</li>\n<li>Stomp</li>\n</ul>\n<hr>\n<h3 id=\"stomp\" style=\"position:relative;\"><a href=\"#stomp\" aria-label=\"stomp permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Stomp</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token annotation punctuation\">@CrossOrigin</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ChatController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">SimpMessagingTemplate</span> simpMessagingTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@MessageMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/chat\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// /pub/chat</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">publishChat</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChatDto</span> chatDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        simpMessagingTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/sub/chat/\"</span> <span class=\"token operator\">+</span> chatDto<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> chatDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"다중-서버\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%A4%91-%EC%84%9C%EB%B2%84\" aria-label=\"다중 서버 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다중 서버</h2>\n<p>한 서버가 수많은 클라이언트와 소켓 연결을 맺는 부하를 감당하기는 어렵기 때문에 Scale-out하여 여러 대의 서버를 사용하게 됩니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4710ced460f0c6b22de3000af0e98f13/2c89e/4_multi-server.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAAB13WFO4UNP//EABkQAAIDAQAAAAAAAAAAAAAAAAECAxESE//aAAgBAQABBQJq6vrC3lies5KxRm4//8QAFhEAAwAAAAAAAAAAAAAAAAAAAhBB/9oACAEDAQE/ARq//8QAFREBAQAAAAAAAAAAAAAAAAAAEFH/2gAIAQIBAT8Bh//EABsQAAICAwEAAAAAAAAAAAAAAAABAjEREiJR/9oACAEBAAY/Ao3k4sW1kUNqyLfh/8QAHBAAAgICAwAAAAAAAAAAAAAAAAERITFBUWFx/9oACAEBAAE/Ic50QXqcZPEbFkHTGnwmxjBLaSf/2gAMAwEAAgADAAAAENQv/8QAGBEBAAMBAAAAAAAAAAAAAAAAARARccH/2gAIAQMBAT8QZe+Ef//EABcRAQEBAQAAAAAAAAAAAAAAAAEAETH/2gAIAQIBAT8QxWPb/8QAHBABAQACAwEBAAAAAAAAAAAAAREAITFBcVGB/9oACAEBAAE/EOZiNIn73iKlaR73lpghrxe8TaG0nOP5IQemW8OX1mf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4_multi-server.jpg\"\n        title=\"4_multi-server.jpg\"\n        src=\"/static/4710ced460f0c6b22de3000af0e98f13/e5166/4_multi-server.jpg\"\n        srcset=\"/static/4710ced460f0c6b22de3000af0e98f13/f93b5/4_multi-server.jpg 300w,\n/static/4710ced460f0c6b22de3000af0e98f13/b4294/4_multi-server.jpg 600w,\n/static/4710ced460f0c6b22de3000af0e98f13/e5166/4_multi-server.jpg 1200w,\n/static/4710ced460f0c6b22de3000af0e98f13/2c89e/4_multi-server.jpg 1568w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>위와 같이 채팅 서버가 다중화 되어 있는 경우, 같은 서버에 연결된 클라이언트 끼리는 서로 통신할 수 있지만, 다른 서버에 연결되어 있다면, 서로의 채팅을 전달할 수 없습니다.</p>\n<h2 id=\"message-queue\" style=\"position:relative;\"><a href=\"#message-queue\" aria-label=\"message queue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Message Queue</h2>\n<p>위 처럼 여러 서버 간에 데이터를 실시간으로 동기화 하기 위해서 Message Queue를 사용할 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1d6bf98857c3d40b50e82bb8b2c24d7d/6382b/5_chat-kafka.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHsokKW4X//xAAbEAABBAMAAAAAAAAAAAAAAAACAAEDMwQjMv/aAAgBAQABBQIOBfW0syCrHpX/xAAXEQADAQAAAAAAAAAAAAAAAAABAhAx/9oACAEDAQE/AUwT/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8BZ//EAB0QAAECBwAAAAAAAAAAAAAAAAABEAISITNRosH/2gAIAQEABj8CwUWfpY2aFv/EABsQAAICAwEAAAAAAAAAAAAAAAExABEQUYGh/9oACAEBAAE/IdJDI3DVNqnBLMcR/Z48f//aAAwDAQACAAMAAAAQZw//xAAWEQADAAAAAAAAAAAAAAAAAAABEJH/2gAIAQMBAT8QKS//xAAXEQEAAwAAAAAAAAAAAAAAAAABECFh/9oACAECAQE/EBS7H//EAB8QAQACAQMFAAAAAAAAAAAAAAEAESExQWFRkaHB8P/aAAgBAQABPxAhgW6kc5gQhtDRbPbpAFYvSyeB7z5eWM//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5_chat-kafka.jpg\"\n        title=\"5_chat-kafka.jpg\"\n        src=\"/static/1d6bf98857c3d40b50e82bb8b2c24d7d/e5166/5_chat-kafka.jpg\"\n        srcset=\"/static/1d6bf98857c3d40b50e82bb8b2c24d7d/f93b5/5_chat-kafka.jpg 300w,\n/static/1d6bf98857c3d40b50e82bb8b2c24d7d/b4294/5_chat-kafka.jpg 600w,\n/static/1d6bf98857c3d40b50e82bb8b2c24d7d/e5166/5_chat-kafka.jpg 1200w,\n/static/1d6bf98857c3d40b50e82bb8b2c24d7d/d9c39/5_chat-kafka.jpg 1800w,\n/static/1d6bf98857c3d40b50e82bb8b2c24d7d/6382b/5_chat-kafka.jpg 1867w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"rabbitmq-vs-kafka\" style=\"position:relative;\"><a href=\"#rabbitmq-vs-kafka\" aria-label=\"rabbitmq vs kafka permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RabbitMQ vs Kafka</h3>\n<p>대표적인 Message Queue의 예로 RabbitMQ와 Kafka를 들 수 있습니다.</p>\n<ul>\n<li>\n<p>RabbitMQ</p>\n<ul>\n<li>Message Broker</li>\n<li>처리하고 삭제</li>\n</ul>\n</li>\n<li>\n<p>Kafka</p>\n<ul>\n<li>Event Broker (Message broker의 역할을 할 수 있다.)</li>\n<li>처리해도 데이터 유지, Offset으로 관리</li>\n</ul>\n</li>\n</ul>\n<p>둘 다 장단점이 있겠지만, Kafka가 더 범용적인 목적으로 사용할 수 있을 것 같아 Kafka를 공부하여 사용해 보았습니다.</p>\n<h2 id=\"구성도\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%EC%84%B1%EB%8F%84\" aria-label=\"구성도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구성도</h2>\n<ul>\n<li>React</li>\n<li>\n<p>Docker-compose</p>\n<ul>\n<li>Nginx</li>\n<li>Java Spring</li>\n<li>Kafka</li>\n<li>Zookeeper</li>\n</ul>\n</li>\n</ul>\n<p>Nginx, Spring server, Kafka, Zookeeper를 docker-compose로 함께 배포하면서 같은 서브넷에서 서로 통신할 수 있도록 구성하였습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a2cf1bf133faff4a348c8c7c82544f36/d3208/6_container-network.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAdiBC4F//8QAGBAAAgMAAAAAAAAAAAAAAAAAAREAEyL/2gAIAQEAAQUCDr0w5//EABcRAAMBAAAAAAAAAAAAAAAAAAECEDH/2gAIAQMBAT8BTBP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAACAQUAAAAAAAAAAAAAAAAAEQISISIxQv/aAAgBAQAGPwLFEqXvouj/xAAaEAABBQEAAAAAAAAAAAAAAAAAESExUWGB/9oACAEBAAE/IWknTQIxwlsZKP/aAAwDAQACAAMAAAAQ9A//xAAYEQACAwAAAAAAAAAAAAAAAAAAARExYf/aAAgBAwEBPxCxiG5P/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAh/9oACAECAQE/EHFn/8QAGxAAAQUBAQAAAAAAAAAAAAAAEQABITFhcfD/2gAIAQEAAT8QbQigsFzqFM3hEx8U1mxZwdX/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"6_container-network.jpg\"\n        title=\"6_container-network.jpg\"\n        src=\"/static/a2cf1bf133faff4a348c8c7c82544f36/e5166/6_container-network.jpg\"\n        srcset=\"/static/a2cf1bf133faff4a348c8c7c82544f36/f93b5/6_container-network.jpg 300w,\n/static/a2cf1bf133faff4a348c8c7c82544f36/b4294/6_container-network.jpg 600w,\n/static/a2cf1bf133faff4a348c8c7c82544f36/e5166/6_container-network.jpg 1200w,\n/static/a2cf1bf133faff4a348c8c7c82544f36/d9c39/6_container-network.jpg 1800w,\n/static/a2cf1bf133faff4a348c8c7c82544f36/d3208/6_container-network.jpg 1967w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>Nginx Container만 포트포워딩하여 로드밸런서를 통해서만 진입할 수 있도록 구성</li>\n<li>로드밸런서, Kafka, Zookeeper를 다중화 하면 좋겠지만, 테스트 환경에서는 단일 노드로 구성</li>\n</ul>\n<hr>\n<h3 id=\"docker-compose\" style=\"position:relative;\"><a href=\"#docker-compose\" aria-label=\"docker compose permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker-compose</h3>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.0\"</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">zookeeper</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> letters_zookeeper\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> bitnami/zookeeper<span class=\"token punctuation\">:</span><span class=\"token number\">3.6</span>\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ALLOW_ANONYMOUS_LOGIN=yes\n      <span class=\"token punctuation\">-</span> ALLOW_PLAINTEXT_LISTENER=yes\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">default_bridge</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ipv4_address</span><span class=\"token punctuation\">:</span> 192.168.0.10\n  <span class=\"token key atrule\">kafka</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> letters_kafka\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> bitnami/kafka<span class=\"token punctuation\">:</span><span class=\"token number\">3.0</span>\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> KAFKA_BROKER_ID=1\n      <span class=\"token punctuation\">-</span> KAFKA_CFG_LISTENERS=PLAINTEXT<span class=\"token punctuation\">:</span>//<span class=\"token punctuation\">:</span><span class=\"token number\">9092</span>\n      <span class=\"token punctuation\">-</span> KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT<span class=\"token punctuation\">:</span>//192.168.0.11<span class=\"token punctuation\">:</span><span class=\"token number\">9092</span>\n      <span class=\"token punctuation\">-</span> KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper<span class=\"token punctuation\">:</span><span class=\"token number\">2181</span>\n      <span class=\"token punctuation\">-</span> ALLOW_PLAINTEXT_LISTENER=yes\n    <span class=\"token comment\">#      - KAFKA_CREATE_TOPICS=chat:1:1</span>\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> zookeeper\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">default_bridge</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ipv4_address</span><span class=\"token punctuation\">:</span> 192.168.0.11\n  <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> letters_backend\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> .\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">default_bridge</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ipv4_address</span><span class=\"token punctuation\">:</span> 192.168.0.20\n  <span class=\"token key atrule\">backend2</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> letters_backend2\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> .\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">default_bridge</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ipv4_address</span><span class=\"token punctuation\">:</span> 192.168.0.21\n  <span class=\"token key atrule\">nginx</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> letters_nginx\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> ./nginx\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"80:80\"</span>\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">default_bridge</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ipv4_address</span><span class=\"token punctuation\">:</span> 192.168.0.30\n\n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">default_bridge</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">ipam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">driver</span><span class=\"token punctuation\">:</span> default\n      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">subnet</span><span class=\"token punctuation\">:</span> 192.168.0.0/16</code></pre></div>\n<hr>\n<h3 id=\"nginx\" style=\"position:relative;\"><a href=\"#nginx\" aria-label=\"nginx permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nginx</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">upstream chat_servers {\n    server 192.168.0.20:8080 weight=1 max_fails=3 fail_timeout=15s;\n    server 192.168.0.21:8080 weight=1 max_fails=3 fail_timeout=15s;\n    keepalive 1024;\n    keepalive_requests 10240;\n    keepalive_timeout 120;\n}\n\nserver {\n    location /letters-chat-server/ {\n        proxy_pass http://chat_servers/letters-chat-server/;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection &quot;Upgrade&quot;;\n        proxy_set_header Host $http_host;\n    }\n}</code></pre></div>"},"primaryTag":{"name":"project","color":"#007acc"}},"pageContext":{"postId":"8d38cb50-9f68-561d-adef-a4abcb7236dc","primaryTag":"project"}},"staticQueryHashes":["1116962356","1994268275","2206391224","2275848304","545095672"]}