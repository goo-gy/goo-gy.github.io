{"componentChunkName":"component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-post-tsx","path":"/2022-05-11-docker-compose","result":{"data":{"post":{"id":"1f465dc0-8097-5e5a-ad80-db947256c0be","headings":[{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":3}],"frontmatter":{"title":"Dockerfile과 docker-compose 활용하기","path":"/2022-05-11-docker-compose","tags":["project","docker","node.js"],"excerpt":"Dockerfile과 docker-compose를 활용하여 더 쉽게 개발환경을 구성하자","created":"2022-05-23T00:00:00.000Z","createdPretty":"23 May, 2022","updated":"2022-05-26T00:00:00.000Z","updatedPretty":"26 May, 2022","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYUlEQVQoz2VS3U9ScRg+ay0zv9ZFM1dOmLUamzXmWluurX+gumjruutaa+uqzVC5kNRiHnW4kCOCZOUgHV/K10HhdBT0DAaDSQQBIh954eFjmYfD79ABlrb1Xrx7f+/7Ps/z254XqvwXADBsDn6P9Argu4NwMp1hnwxTbQKGKTMMAICtQ6EQ9A8GlGg6Xyjm8gXq6MjtC/RNL92b/BxL7tWn1UyXAE2Va/XOMbhOnC8UwpHoAZk7IMlwfO/HPukkPIkauA7QbflefdBVaOpEmWUtg3I0lbF7/PG9dJ2t+PuIPKTtLsKIu8LJ9CFVYhf7DRsXVH6jbe0wR3q9XojVBFVZ5vGYpOHFGznq3g6nD7IxZhetZL9iHm/by5E7AvGvYoGlnLfhnOXoJcRxfsr0aGCsqpz8uY96AvdhZYdQJlqyzdkJNU5sYLptbBkxmi6LlH0iqdnttfhCzzXrHQh2S+V8ZtzSWlEomUhMaC3NUza+zH5z0c/ThHgfvbxx7VUF0a2JXJc5+ZKVHnXwymLwmopoRjYfyvXJoH83HguHv0HWtfXxBXX70Fz3sLIL1nHeo10Teu6QjCvWcKQod/QTZ3Cmc9LAmbZ0jqo5T4VfVszb/oDe7nDiePXb6VTq4oAcQrZOz2DQtIMvXelRYWflrlYEa1W4WhTuFom9AbZC/Qtvly3sPn3sc7l2EmKN8YZQ+kCx+mRhtXfW3I442mbxNhnWLEGbYMupd+aG1/MjamOlTIO/np8cSYmi1HqDxokHM1kBvnNmwtoEm8+JVxvFpkbR0u1huWmTqDCAZo2pRR38B0PY6WW2sZx4AAAAAElFTkSuQmCC","aspectRatio":1.9047619047619047,"src":"/static/92651d2ad61f92159f5312e17a950bf3/b30e3/docker-mysql.png","srcSet":"/static/92651d2ad61f92159f5312e17a950bf3/dc47e/docker-mysql.png 200w,\n/static/92651d2ad61f92159f5312e17a950bf3/9f2d5/docker-mysql.png 400w,\n/static/92651d2ad61f92159f5312e17a950bf3/b30e3/docker-mysql.png 656w","sizes":"(max-width: 656px) 100vw, 656px"}}}},"html":"<h2 id=\"database-구축하기\" style=\"position:relative;\"><a href=\"#database-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0\" aria-label=\"database 구축하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Database 구축하기</h2>\n<p>서비스를 개발하려면 Database는 필수적이다. 하지만 Database 구축하고 관리하는 것은 쉽지 않다. 하지만 Docker를 이용하면 간편하게 Database를 구축하고 관리할 수 있다. 오늘은 Docker를 이용해 MySQL container를 올리는 방법과 dockerfile, docker-compose 등을 이용해 여러 추가 작업까지 해주는 방법을 알아볼 것이다. Docker에 대해서 잘 모르는 분은 이전 포스팅 <a href=\"https://goo-gy.github.io/2022-03-11-docker\">Docker로 MySQL 컨테이너 만들기</a>를 먼저 읽고 오면 어렵지 않게 이해할 수 있을 것이다.  </p>\n<h2 id=\"mysql-image\" style=\"position:relative;\"><a href=\"#mysql-image\" aria-label=\"mysql image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MySQL image</h2>\n<p><a href=\"https://hub.docker.com/_/mysql\">https://hub.docker.com/_/mysql</a><br>\n먼저 Docker hub의 MySQL image 문서에서 필요한 정보를 얻을 수 있으니 한 번 읽어보자.  </p>\n<hr>\n<h3 id=\"mysql-container-생성\" style=\"position:relative;\"><a href=\"#mysql-container-%EC%83%9D%EC%84%B1\" aria-label=\"mysql container 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MySQL container 생성</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker run --name <span class=\"token punctuation\">[</span>container name<span class=\"token punctuation\">]</span> -p <span class=\"token number\">3306</span>:3306 -e <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>password<span class=\"token punctuation\">]</span> -d mysql:8.0</code></pre></div>\n<p>가장 간단한 방법으로 위 명령어로 MySQL conatiner를 올릴 수 있다. <code class=\"language-text\">-p</code> 옵션으로 포트포워딩을 해주고, <code class=\"language-text\">-e</code> 옵션으로 Password로 사용할 환경변수를 설정해 줄 수 있다. 이렇게 명령어 한 줄로 mysql container를 올려두면, 우리의 서비스에서 이 Database를 사용할 수 있다.  </p>\n<hr>\n<h3 id=\"mysql-image-1\" style=\"position:relative;\"><a href=\"#mysql-image-1\" aria-label=\"mysql image 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MySQL image</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/30395f2b19ec253460fa0feb4bcccd4b/8d68c/db_init.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABJ0AAASdAHeZh94AAAAd0lEQVQI152OyQ7DMAhE/f8f2ioJxhteah8m4KhSz0UaAY9B4FIWvI4L75NwXB4n8a6lNvwTruoihwSOGSEVRD1gNbGxBNIZcQT5AK/Zh0fGrDevV4+xORdcLrI/M0OuHX18IG1s1dZVA0W5fWy95V99WZGKuRZuD/TnqEeHwPwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"db_init.png\"\n        title=\"db_init.png\"\n        src=\"/static/30395f2b19ec253460fa0feb4bcccd4b/c1b63/db_init.png\"\n        srcset=\"/static/30395f2b19ec253460fa0feb4bcccd4b/5a46d/db_init.png 300w,\n/static/30395f2b19ec253460fa0feb4bcccd4b/0a47e/db_init.png 600w,\n/static/30395f2b19ec253460fa0feb4bcccd4b/c1b63/db_init.png 1200w,\n/static/30395f2b19ec253460fa0feb4bcccd4b/8d68c/db_init.png 1234w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br>\n문서를 살펴보면 위와 같은 내용을 확인할 수 있다. container가 처음으로 시작될 때, <code class=\"language-text\">/docker-entrypoint-initdb.d</code> 경로에 있는  <code class=\"language-text\">.sh</code>, <code class=\"language-text\">.sql</code>, <code class=\"language-text\">.sql.gz</code> 파일을 실행시킨다고 한다. Dockerfile을 이용해서 해당 경로에 파일을 복사하는 작업을 수행해 보자.    </p>\n<h2 id=\"dockerfile\" style=\"position:relative;\"><a href=\"#dockerfile\" aria-label=\"dockerfile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>dockerfile</h2>\n<p>개발환경을 구축할 때 우리는 이미 MySQL이라는 Image를 통해 편하게 MySQL 서비스를 올릴 수 있었지만, Database에는 아무것도 들어있지 않다.\n<strong>Dockerfile을 활용하면, Docker Image를 커스터마이징 해서 추가적인 작업을 할 수 있다.</strong>\n그러면 개발 환경을 구성할 때 매번 MySQL에 접속해서 Database를 생성하는 작업을 하지 않아도 되도록,\nDockerfile을 이용해서 <code class=\"language-text\">/docker-entrypoint-initdb.d</code> 경로에 Database를 생성하는 <code class=\"language-text\">createDB.sql</code> 파일을 작성하자. (그러면 mysql container가 알아서 실행해 줄 것이다.)  </p>\n<hr>\n<h3 id=\"sql-query-작성\" style=\"position:relative;\"><a href=\"#sql-query-%EC%9E%91%EC%84%B1\" aria-label=\"sql query 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQL query 작성</h3>\n<ul>\n<li><strong>createDB.sql</strong>  </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> chat</code></pre></div>\n<p>MySQL 컨테이너가 실행되면 실행할 SQL query를 작성해두었다.  </p>\n<hr>\n<h3 id=\"dockerfile-작성\" style=\"position:relative;\"><a href=\"#dockerfile-%EC%9E%91%EC%84%B1\" aria-label=\"dockerfile 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>dockerfile 작성</h3>\n<ul>\n<li><strong>dockerfile</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\"><span class=\"token keyword\">FROM</span> mysql<span class=\"token punctuation\">:</span>8.0\n\n<span class=\"token keyword\">COPY</span> createDB.sql /docker<span class=\"token punctuation\">-</span>entrypoint<span class=\"token punctuation\">-</span>initdb.d</code></pre></div>\n<p>먼저 mysql:8.0 컨테이너로부터 시작한다.\n추가적으로 컨테이너가 생성될 때 <code class=\"language-text\">createDB.sql</code> 파일을 <code class=\"language-text\">/docker-entrypoint-initdb.d</code> 경로에 복사한다.\n복사 작업 외에도 Container가 실행될 때 명령어를 실행하는 등의 여러 가지 작업을 할 수 있다.  </p>\n<ul>\n<li><strong>FROM</strong><br>\n추가적인 작업을 할 Base image를 지정한다. (Github에서 fork/clone 하여 작업하는 것과 유사하다.)  </li>\n<li><strong>COPY</strong><br>\nContainer에 파일을 복사한다. (현재 경로보다 상위 Directory에 있는 파일을 복사할 수는 없다.)</li>\n<li><strong>RUN</strong><br>\n컨테이너를 Build 할 때 (Image 단에서) 실행할 명령어를 지정한다.  </li>\n<li><strong>CMD</strong><br>\n컨테이너가 시작될 때 실행하는 명령어를 지정한다.  </li>\n<li><strong>WORKDIR</strong><br>\n명령이 실행될 경로를 지정한다.  </li>\n</ul>\n<p>dockerfile의 더 자세한 문법은 <a href=\"https://docs.docker.com/engine/reference/builder/\">https://docs.docker.com/engine/reference/builder/</a>을 참고하자.  </p>\n<hr>\n<h3 id=\"빌드-및-실행\" style=\"position:relative;\"><a href=\"#%EB%B9%8C%EB%93%9C-%EB%B0%8F-%EC%8B%A4%ED%96%89\" aria-label=\"빌드 및 실행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>빌드 및 실행</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker build --tag <span class=\"token punctuation\">[</span>image name<span class=\"token punctuation\">]</span> <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>Dockerfile을 Build 하는 것은 Docker image를 만드는 작업이다. 따라서 <code class=\"language-text\">--tag</code> 옵션을 통해 Image 이름을 지정해 주자.  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 856px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1163e90e94aac696963db913b09b8028/ad12c/docker_build.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.999999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABJ0AAASdAHeZh94AAAAwElEQVQY01WP4ZLCIAyE+x4lUBAI1FqLVuzd3Knv/1J7sb0Z9cfOFzKbLGl0t4PmGab/gskLzHCDSbP0zmtfx9MnbRQFaMf/dXzVRGjIWKgwgfofqPQNlX/RWgZ1/mV8H/5Q2Pj0Wl7fjXUeIY+I0x2pXEQVucgv8xU6VRBfJPAE5TLoGSRSXRSmjS5tgbu8Lm9KKXg87hjHA2JQYDbCgGHoYbTCYdhjWSo4elFArTMSB3jvME3H1UOqlXNbECn8AVt8cy0/yQ3TAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"docker_build.png\"\n        title=\"docker_build.png\"\n        src=\"/static/1163e90e94aac696963db913b09b8028/ad12c/docker_build.png\"\n        srcset=\"/static/1163e90e94aac696963db913b09b8028/5a46d/docker_build.png 300w,\n/static/1163e90e94aac696963db913b09b8028/0a47e/docker_build.png 600w,\n/static/1163e90e94aac696963db913b09b8028/ad12c/docker_build.png 856w\"\n        sizes=\"(max-width: 856px) 100vw, 856px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>  </p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker images\ndocker run --name <span class=\"token punctuation\">[</span>container name<span class=\"token punctuation\">]</span> -p <span class=\"token number\">3306</span>:3306 -e <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>password<span class=\"token punctuation\">]</span> -d <span class=\"token punctuation\">[</span>image name<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Build 했다면 Docker image가 제대로 생성되었는지 확인하고 새로 만든 이미지로 실행하자. </p>\n<hr>\n<h3 id=\"확인\" style=\"position:relative;\"><a href=\"#%ED%99%95%EC%9D%B8\" aria-label=\"확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>확인</h3>\n<p>Docker build부터 실행까지 모두 완료했으니 이제 접속해서 원하는 작업이 완료되었는지 확인해 보자.  </p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker <span class=\"token builtin class-name\">exec</span> -it <span class=\"token punctuation\">[</span>container name<span class=\"token punctuation\">]</span> /bin/bash</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1031px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3e72e515a6d1457b0f4375cb4873d0b1/23592/check_db.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABJ0AAASdAHeZh94AAABXElEQVQoz51SSXKDMBDkHd4xixGIRSBs8JZyxf//Ukc9jg5OTCrJYWpGhdTTC4ExLc6XKy7XFte3Gq3p0PcW4zDgfDphcH2/32McR5RlCa1LFEWBuq5RVRXyPEeSpO6bRhzHCAZ38f1+x+12xuFg0LatXGTXWkMpJUC7NMVqtcJ8PsdisZDuZ39eLpcI+r4XFrazsLZH13VQbiuZECx126MowmazkQcE/akCbm9MI6yauhEpTdM4Vg85rDRJMJvNvgG+WhAQSDtPCMy5rEoB1c4TSq7rxzL6RqaURyAP9hU0oETxaLeTR/5xWXmGhQMuBPwhPUQYhtMMsyyDyhTYCZo4eUxru90iciXnKJaeumCyz7uTgJREzxhArnKs1+snWX72afqalMw0KY0pkhnl/CbNSYYH98scT0fx0RgjHk1t/02Jh2RGjzjTu/8APf021lrEDjBxpv9F8qv6AL4jVk69DAcZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"check_db.png\"\n        title=\"check_db.png\"\n        src=\"/static/3e72e515a6d1457b0f4375cb4873d0b1/23592/check_db.png\"\n        srcset=\"/static/3e72e515a6d1457b0f4375cb4873d0b1/5a46d/check_db.png 300w,\n/static/3e72e515a6d1457b0f4375cb4873d0b1/0a47e/check_db.png 600w,\n/static/3e72e515a6d1457b0f4375cb4873d0b1/23592/check_db.png 1031w\"\n        sizes=\"(max-width: 1031px) 100vw, 1031px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>  </p>\n<p>앞서 작성한 SQL이 실행되어 <strong>'chat'</strong> Database가 생성된 것을 확인할 수 있다.  </p>\n<h2 id=\"docker-compose\" style=\"position:relative;\"><a href=\"#docker-compose\" aria-label=\"docker compose permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker-compose</h2>\n<p>dockerfile을 작성하여 Database를 생성하는 작업을 자동화해주었다. 하지만 아직 run 명령어에서 여러 가지 설정도 해주어야 하는 불편함이 있다. docker-compose를 이용해서 더 간단한 명령어로 MySQL container를 구축해 보자.  </p>\n<hr>\n<h3 id=\"env\" style=\"position:relative;\"><a href=\"#env\" aria-label=\"env permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>.env</h3>\n<ul>\n<li><strong>.env</strong>  </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">DB_HOST=localhost\nDB_USER=root\nDB_PASSWORD=1234qwer</code></pre></div>\n<p>비밀번호와 같이 민감한 정보들은 docker-compose.yml 파일에 바로 작성하는 대신 <code class=\"language-text\">.env</code>에 저장하여 사용하자.  </p>\n<hr>\n<h3 id=\"docker-composeyml\" style=\"position:relative;\"><a href=\"#docker-composeyml\" aria-label=\"docker composeyml permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker-compose.yml</h3>\n<ul>\n<li><strong>docker-compose.yml</strong>  </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.0\"</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">chat_db</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> chat_db_container\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> .\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3306:3306\"</span>\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">MYSQL_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>DB_PASSWORD<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>version<br>\ndocker-compose에서 사용할 version을 지정한다. </li>\n<li>services<br>\ncompose에서 등록할 service들을 지정한다. 각 service에서 아래와 같은 설정들을 지정할 수 있다.  </li>\n<li>image<br>\nBase image를 지정한다.  </li>\n<li>build<br>\nimage를 지정하는 대신 dockerfile을 build 하여 사용할 수도 있다.<br>\n생성될 Image name은 따로 지정하지 않는다면 <code class=\"language-text\">directory이름_service이름</code>으로 결정된다.  </li>\n<li>environment<br>\n환경변수를 지정한다.  </li>\n<li>ports<br>\n포트포워딩을 설정한다.  </li>\n</ul>\n<p><code class=\"language-text\">docker-compose.yml</code> 내용을 살펴보면 우리가 MySQL container를 실행할 때 사용했던 Option들을 지정해 줄 수 있다. 더 자세한 문법은 <a href=\"https://docs.docker.com/compose/compose-file/\">https://docs.docker.com/compose/compose-file/</a>를 참고하자.</p>\n<hr>\n<h3 id=\"실행\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%ED%96%89\" aria-label=\"실행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실행</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker-compose up -d</code></pre></div>\n<p><code class=\"language-text\">dockerfile</code>과 <code class=\"language-text\">docker-compose.yml</code>을 잘 구성하여 배포하면, 다른 개발자들은 이렇게 간단한 명령어로 쉽게 개발환경을 구축할 수 있다. 그리고 비밀번호와 같이 민감한 정보들을 <code class=\"language-text\">.env</code>에 저장하여 활용할 수 있었다.  </p>\n<hr>\n<h3 id=\"docker-compose-명령어\" style=\"position:relative;\"><a href=\"#docker-compose-%EB%AA%85%EB%A0%B9%EC%96%B4\" aria-label=\"docker compose 명령어 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker-compose 명령어</h3>\n<p>마지막으로 docker-compose의 몇 가지 명령어를 살펴보자.  </p>\n<ul>\n<li><strong>up</strong><br>\nContainer 생성/시작</li>\n<li><strong>down</strong><br>\nContainer 중지/삭제</li>\n<li><strong>start</strong><br>\nContainer 시작</li>\n<li><strong>stop</strong><br>\nContainer 중지</li>\n<li><strong>logs</strong><br>\nContainer 로그 출력  </li>\n<li><strong>config</strong><br>\nDocker-compose 설정 확인<br>\n(env 변수 등을 활용할 때 제대로 적용되었는지 확인해 볼 수 있다.)</li>\n</ul>\n<p>docker-compose 명령어는 <code class=\"language-text\">docker-compose.yml</code>이 있는 경로에서 실행하거나 <code class=\"language-text\">-f</code> 옵션을 통해 docker-compose 파일을 지정해야 한다.  </p>"},"primaryTag":{"name":"project","color":"#007acc"}},"pageContext":{"postId":"1f465dc0-8097-5e5a-ad80-db947256c0be","primaryTag":"project"}},"staticQueryHashes":["1116962356","1994268275","2206391224","2275848304","545095672"]}